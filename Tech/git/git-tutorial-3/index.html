<!DOCTYPE HTML>
<html>
<head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="chrome=1">
    
    <title>Git指南（3）——分支与合并 | Ray Taylor Lin&#39;s world</title>
    <meta name="author" content="林寿山">
    
    <meta name="description" content="几乎每一种版本控制系统都以某种形式支持分支。使用分支意味着你可以从开发主线上分离开来，然后在不影响主线的同时继续工作。相比同类软件，Git很显著的一个优点，就是版本的分支（branch）和合并（merge）十分方便。有人把Git的分支模型称为“必杀技特性”，因为它的分支可谓是难以置信的轻量级。理解分支的概念并熟练运用后，你才会意识到为什么Git是一个如此强大而独特的工具，并从此真正改变你的开发方式。本文将简单介绍Git的分支与合并的基本知识。">
    
    
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no">

    <meta property="og:title" content="Git指南（3）——分支与合并"/>
    <meta property="og:site_name" content="林寿山的技术博客 Ray Taylor Lin&#39;s world"/>

    <link rel="alternate" href="/atom.xml" title="Ray Taylor Lin&#39;s world" type="application/atom+xml">
    <link rel="stylesheet" href="/css/lib/font-awesome.css" type="text/css">
    <link rel="stylesheet" href="/css/lib/normalize.css" type="text/css">
    <link rel="stylesheet" href="/css/lib/furatto.css" type="text/css">
    <link rel="stylesheet" href="/css/style.css" media="screen" type="text/css">

    
        <link rel="stylesheet" href="/css/lib/prettify_raytaylorism.css" type="text/css">
        
    
    <link rel="icon" type="image/x-icon" href="/favicon.ico">
    <!--[if lt IE 9]><script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script><![endif]-->
    <script src="/js/jquery-1.10.2.min.js"></script>
    <script src="/js/jquery.jpanelmenu.js"></script>
</head>


<body class="container-fluid">
    <header id="page-header">
        <div class="navbar inverse-navbar">
    <div class="navbar-inner">
        <div class="container-center">
            <a href="/index.html" class="menu-trigger" data-meteocon="M">
                <i class="icon-reorder"></i>
            </a>
            <div class="nav-collapse navbar-responsive-collapse collapse">
                <nav id="menu">
                    <ul class="nav">
                        <li><a class="brand" id="blog-title" href="/index.html">Ray Taylor Lin&#39;s world</a></li>
                    </ul>
                    <div class="pull-right nav" id="nav-button-group">
                        
                            <a href="/" class="menu-home btn btn-primary btn-large">
                                <i class="icon-home icon-white"></i>
                                首页
                            </a>
                        
                            <a href="/archives" class="menu-archive btn btn-primary btn-large">
                                <i class="icon-archive icon-white"></i>
                                归档
                            </a>
                        
                            <a href="javascript:void(0);" class="menu-category btn btn-primary btn-large">
                                <i class="icon-archive icon-white"></i>
                                分类
                            </a>
                        
                            <a href="/reading" class="menu-reading btn btn-primary btn-large">
                                <i class="icon-book icon-white"></i>
                                读书
                            </a>
                        
                            <a href="/about" class="menu-about btn btn-primary btn-large">
                                <i class="icon-user icon-white"></i>
                                关于
                            </a>
                        
                    </div>
                </nav>
                <nav id="jPanelMenu-menu-side">
    <ul class="nav main-menu">
        <li><a class="brand" href="index.html">Ray Taylor Lin&#39;s world</a></li>
        
            <li>
                <a href="/" class="menu-home">
                    <i class="icon-home icon-white"></i>
                    首页
                </a>
            </li>
        
            <li>
                <a href="/archives" class="menu-archive">
                    <i class="icon-archive icon-white"></i>
                    归档
                </a>
            </li>
        
            <li>
                <a href="javascript:void(0);" class="menu-category">
                    <i class="icon-archive icon-white"></i>
                    分类
                </a>
            </li>
        
            <li>
                <a href="/reading" class="menu-reading">
                    <i class="icon-book icon-white"></i>
                    读书
                </a>
            </li>
        
            <li>
                <a href="/about" class="menu-about">
                    <i class="icon-user icon-white"></i>
                    关于
                </a>
            </li>
        
    </ul>

    <ul class="nav category-menu hide">
        <li>
            <span><a class="brand" href="javascript:void(0);">分类目录</a></span>
            <span><a class="btn-back brand pull-right" href="javascript:void(0);">
                <i class="icon-arrow-left"></i>
            </a></span>
        </li>

        

        

            

            <li collapse-level="0">
                <a href="/categories/daily/" class="collapse-level-0">
                    <i class="icon-caret-right"></i>
                    daily(6)
                </a>
            </li>

            

            

        

            <li collapse-level="0">
                <a href="/categories/Tech/" class="collapse-level-0">
                    <i class="icon-caret-right"></i>
                    Tech(22)
                </a>
            </li>

            

            

            <li collapse-level="1">
                <a href="/categories/Tech/git/" class="collapse-level-1">
                    <i class="icon-caret-right"></i>
                    git(4)
                </a>
            </li>

            

            

        

            <li collapse-level="1">
                <a href="/categories/Tech/IDE/" class="collapse-level-1">
                    <i class="icon-caret-right"></i>
                    IDE(1)
                </a>
            </li>

            

            

        

            <li collapse-level="1">
                <a href="/categories/Tech/other/" class="collapse-level-1">
                    <i class="icon-caret-right"></i>
                    other(1)
                </a>
            </li>

            

            

        

            <li collapse-level="1">
                <a href="/categories/Tech/Script/" class="collapse-level-1">
                    <i class="icon-caret-right"></i>
                    Script(7)
                </a>
            </li>

            

            

            <li collapse-level="2">
                <a href="/categories/Tech/Script/Lua/" class="collapse-level-2">
                    <i class="icon-caret-right"></i>
                    Lua(3)
                </a>
            </li>

            

            

        

            <li collapse-level="2">
                <a href="/categories/Tech/Script/Python/" class="collapse-level-2">
                    <i class="icon-caret-right"></i>
                    Python(4)
                </a>
            </li>

            

            

        

        

            <li collapse-level="1">
                <a href="/categories/Tech/web/" class="collapse-level-1">
                    <i class="icon-caret-right"></i>
                    web(9)
                </a>
            </li>

            

            

            <li collapse-level="2">
                <a href="/categories/Tech/web/HTML5/" class="collapse-level-2">
                    <i class="icon-caret-right"></i>
                    HTML5(1)
                </a>
            </li>

            

            

        

            <li collapse-level="2">
                <a href="/categories/Tech/web/HTTP/" class="collapse-level-2">
                    <i class="icon-caret-right"></i>
                    HTTP(4)
                </a>
            </li>

            

            

        

            <li collapse-level="2">
                <a href="/categories/Tech/web/Node.js/" class="collapse-level-2">
                    <i class="icon-caret-right"></i>
                    Node.js(4)
                </a>
            </li>

            

            

        

        

        

        
    </ul>
</nav>
            </div>
        </div>
    </div>
</div>

    </header>
    <div id="content-wrapper">
        <div class="container-center">
        <article class="post">
    <div class="article-title article-title-big">
        
    
        <h1>Git指南（3）——分支与合并</h1>
    

    </div>

    <div class="date-row ">
        <time datetime="2014-02-19T09:18:08.000Z">2014-02-19</time>
    </div>

    <div class="entry">
        <p>几乎每一种版本控制系统都以某种形式支持分支。使用分支意味着你可以从开发主线上分离开来，然后在不影响主线的同时继续工作。相比同类软件，Git很显著的一个优点，就是版本的分支（branch）和合并（merge）十分方便。有人把Git的分支模型称为“必杀技特性”，因为它的分支可谓是难以置信的轻量级。理解分支的概念并熟练运用后，你才会意识到为什么Git是一个如此强大而独特的工具，并从此真正改变你的开发方式。本文将简单介绍Git的分支与合并的基本知识。</p>
<a id="more"></a>

<h1 id="1-git-">1. Git分支管理策略</h1>
<p>Git的新建分支操作几乎可以在瞬间完成，并且在不同分支间切换起来也差不多一样快。和许多其他版本控制系统不同，Git鼓励在工作流程中频繁使用分支与合并，哪怕一天之内进行许多次都没有关系。</p>
<p>但是太方便了也会产生副作用。如果你不加注意，很可能会留下一个枝节蔓生、四处开放的版本库，到处都是分支，完全看不出主干发展的脉络。所以在学习Git的分支之前，有必要先了解一下常用的分支管理策略。</p>
<p>（本节参考自<a href="http://www.ruanyifeng.com/blog/2012/07/git.html" target="_blank">阮一峰的《Git分支管理策略》</a>）</p>
<ol>
<li>主分支master：代码库应该有且只有一个主分支。所有提供给用户使用的正式版本，都在这个主分支上发布。</li>
<li>开发分支develop：主分支只用来分布重大版本，日常开发应该在开发分支Develop上完成。如果想正式对外发布，就在Master分支上，对Develop分支进行“合并”。</li>
<li>功能分支feature：从develop上衍生出来，一般是为了开发某种特定功能，开发完成后，要再合并入develop。分支名字可以采用<code>feature-*</code>的形式命名。</li>
<li>修补bug分支fixbug：软件正式发布以后，难免会出现bug。这时就需要从master分支上面分出来，进行bug修补，修补结束以后，再合并进master和develop分支。分支名字可以采用<code>fixbug-*</code>的形式命名。</li>
<li>预发布分支release：发布正式版本之前（即合并到Master分支之前），可能需要从develop分支上分出来一个预发布的版本进行测试，预发布结束以后，必须合并进develop和master分支。分支名字可以采用<code>release-*</code>的形式命名。（此种分支一般比较少用）</li>
</ol>
<p>以上的功能分支、修补bug分支和预发布分支都属于临时性分支，一般使用完以后要删除掉这种分支，使得代码库的常设分支只有master和develop。最后以一张图总结一下常用的分支形式图。</p>
<p><img src="http://ww4.sinaimg.cn/large/74990035jw1edxyy0ihiqj20hs0dcaau.jpg" alt="Git分支管理示意图"></p>
<h1 id="2-">2. 分支与管理命令</h1>
<p>以下命令用来创建一个新的分支。</p>
<pre><code>git checkout -b develop
# 与git branch develop等价
</code></pre><p>创建完后执行<code>git status</code>会告诉你现在处于新的develop的分支，执行<code>git branch</code>可以看到仓库中存在的所有分支。在新的分支下你可以正常地编辑代码和提交，而不会影响到其他分支上的代码。如果你想切换回主分支，直接<code>git checkout master</code>即可。</p>
<p>上一节介绍了一些临时性分支，往往使用完毕后要删除，命令如下：</p>
<pre><code>git branch -d fixbug-somebug
# -d参数只能删除那些已经被当前分支合并的分支，如果要强制删除未被合并的分支，使用-D参数
</code></pre><p>有分支就会有合并，否则分支就失去了它的意义。下面的例子先切换到master，然后把develop分支的改动合并到主分支上：</p>
<pre><code>git checkout master
git merge develop
</code></pre><p>Git的合并功能非常强大，很多情况下它都会非常智能地帮你自动合并分支的代码，但是有时候也会出现冲突（conflict）而无法自动合并的情况，这时就需要我们手动来解决冲突。现在假设你在合并代码的时候，hello.py这个文件出现了冲突，该文件冲突的地方大概会是下面这个样子：</p>
<pre><code>&lt;&lt;&lt;&lt;&lt;&lt;&lt; HEAD
print &#39;This is the HEAD of master branch&#39;

=======
print &#39;The conflict code of develop branch&#39;
&gt;&gt;&gt;&gt;&gt;&gt;&gt; master
</code></pre><p>Git会自动给冲突的代码填上一些看上去和你奇怪的标记表明两个分支上代码的差异，手动解决冲突只要保留你想要的代码（也可以修改它们），然后删除多余的“&lt;&lt;&lt;&lt;”“====”“&gt;&gt;&gt;&gt;”行即可。最后记得要commit一下提交你的修改，如果出现“fixed conflict”字样就表明冲突已解决。</p>
<p>如果是少量的代码冲突用手动解决还好，当碰上大量的代码冲突时，直接在源文件中看有点力不从心了。如果你安装了Git Tortoise这个软件，就可以使用里面的图形化冲突解决工具，左右两个窗口对比着来解决冲突。当然也可以使用其他的第三方工具来合并。</p>
<h1 id="3-">3. 变基简介</h1>
<p>Git还提供了一种合并功能，称为变基（rebase），它和上面提到的合并（merge）非常相似。下面以一个例子来讲解它们的区别：假设现在本地repo处于master分支，远程repo处于origin/master分支，它们的分支路线图如下：</p>
<pre><code>       D---E master
      /
 A---B---C---F origin/master
</code></pre><p>使用merge合并后，路线分支图如下：</p>
<pre><code>      D--------E  
     /           \
A---B---C-----F---G   master, origin/master
</code></pre><p>而使用进行变基合并后，路线分支图如下：</p>
<pre><code>A---B---C---F---D&#39;---E&#39;   master, origin/master
</code></pre><p>也就是说，使用rebase来合并分支可以让你的分支路线图看起来只有一条主线。此外，本地的分支之间也可以使用变基合并，比如把fixbug分支变基到master分支，只需要：</p>
<pre><code>git checkout master
git rebase fixbug
</code></pre><p>拉取pull预设的行为是将远程的repo与本地的repo合并，如果本地的branch和远端的branch会同步得非常频繁（几乎是完全同步），这时候就会发现pull下来经常会冲突，然后用merge就会造成路线图变得很复杂，难以看到开发的主线，就像下图所示。这时候就会推荐使用<code>git pull --rebase</code>来进行变基拉取。</p>
<p><img src="http://ww1.sinaimg.cn/large/74990035jw1edyw1vany9j20hr09adhe.jpg" alt="复杂的分支路线图"></p>
<p>在rebase的过程中，也许会出现冲突，Git会停止rebase并会让你去解决冲突。解决完冲突后，用<code>git-add</code>命令去更新这些内容的，只要执行以下语句（不需要提交commit）。</p>
<pre><code>git rebase --continue
</code></pre><p>这样git会继续应用余下的补丁。在任何时候，你可以用<code>git rebase --abort</code>来终止rebase的行动，并且分支会回退到rebase开始前的状态。</p>
<p>虽然rebase可以让路线图看起来非常干净，但使用它还是具有一定风险的！要记住：<strong>一旦分支中的提交对象发布到公共仓库，就千万不要对该分支进行rebase操作。</strong>在进行rebase的时候，实际上抛弃了一些现存的提交对象而创造了一些类似但不同的新的提交对象。如果你把原来分支中的提交对象发布出去，并且其他人更新下载后在其基础上开展工作，而稍后你又用git rebase抛弃这些提交对象，把新的重演后的提交对象发布出去的话，你的合作者就不得不重新合并他们的工作，这样当你再次从他们那里获取内容时，提交历史就会变得一团糟。</p>
<p>总而言之，<strong>如果把衍合当成一种在推送之前清理提交历史的手段，而且仅仅rebase那些尚未公开的提交对象，就没问题。如果rebase那些已经公开的提交对象，并且已经有人基于这些提交对象开展了后续开发工作的话，就会出现叫人沮丧的麻烦。</strong>（参考此处<a href="http://git-scm.com/book/zh/Git-%E5%88%86%E6%94%AF-%E5%88%86%E6%94%AF%E7%9A%84%E8%A1%8D%E5%90%88" target="_blank">麻烦的例子</a>）</p>

    </div>
    
    <footer >
        
            
    
    <div class="categories">
        所属目录：
    <a href="/categories/Tech/">Tech</a> -> <a href="/categories/Tech/git/">git</a>
    </div>

            
    
    <div class="tags-row">
        标签：<a class="btn btn-info" href="/tags/Git/">Git</a>
    </div>

        
        <div class="clearfix"></div>
    </footer>
</article>



<section id="comment">
    <h1 class="page-sub-title">留言</h1>
    <!-- Duoshuo Comment BEGIN -->
    <div class="ds-thread" data-title="Git指南（3）——分支与合并">

    <script type="text/javascript">
        var duoshuoQuery = {short_name:"raytaylorlin"};
        (function() {
            var ds = document.createElement('script');
            ds.type = 'text/javascript';
            ds.async = true;
            ds.src = 'http://static.duoshuo.com/embed.js';
            ds.charset = 'UTF-8';
            (document.getElementsByTagName('head')[0] 
            || document.getElementsByTagName('body')[0]).appendChild(ds);
        })();
    </script>
    <!-- Duoshuo Comment END -->
    </div>
</section>


        </div>
    </div>
    <footer id="page-footer"><div class="footer-content">
    <div class="container-center">
        <div class="footer-text pull-left">
            <div class="copyright">
                
                Copyright &copy; 2014 <a href="/">林寿山</a>
                
            </div>
            <div class="theme-copyright">
                <span>Blog powered by <a href="http://zespia.tw/hexo/zh-CN/">hexo</a></span>
                Theme <a href="https://github.com/raytaylorlin/hexo-theme-raytaylorism">raytaylorism</a> desgined by <strong>Nix</strong>
            </div>
        </div>
        <div class="social-group pull-right">
            
            <a href="https://github.com/raytaylorlin" target="_blank" title="github"><i class="icon-github"></i></a>
            
            
            <a href="http://weibo.com/1956184117" target="_blank" title="新浪微博"><i class="icon-weibo"></i></a>
            
            
            <a href="http://www.renren.com/309069699" target="_blank" title="人人网"><i class="icon-renren"></i></a>
            
            
            <a href="https://plus.google.com/113216251417550089742?rel=author" target="_blank" title="Google+"><i class="icon-google-plus-sign"></i></a>
            
        </div>
        <div class="clearfix"></div>
    </div>
</div>
</footer>
    
<script>
    (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
    (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
    m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
    })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

    ga('create', 'UA-43460643-1', 'raytaylorlin.com');
    ga('send', 'pageview');

</script>


<script src="/js/prettify.js"></script>
<script type="text/javascript">
    $(document).ready(function() {
        $("pre").addClass("prettyprint");
        prettyPrint();
    });
</script>

<script>
    (function($) {
        //当内容区内容不够长时，设置内容区域的高度使footer沉底
        var resizeContentWrapper = function() {
            //HACK: 用延时的方法使计算高度时候更加准确，会有一闪的情况
            setTimeout(function() {
                var contentHeight = Math.floor($('#content-wrapper .container-center').height()),
                headerHeight = Math.floor($('#page-header').height()),
                footerHeight = Math.floor($('#page-footer').height()),
                minHeight = Math.floor($(window).height() - headerHeight - footerHeight);
                if(contentHeight < minHeight) {
                    $('#content-wrapper').css({height: minHeight});                    
                } else {
                    $('#content-wrapper').css({height: 'auto'});
                }
            },500);
        };

        //响应式侧边栏
        var initJPanelMenu = function() {
            var jPM = $.jPanelMenu({
                menu: '#jPanelMenu-menu-side',
                duration: 500
            });
            jPM.on();
        };

        //初始化目录按钮事件绑定
        var initCategory = function() {
            function showMainMenu() {
                var $jPanelMenu = $('#jPanelMenu-menu');
                $jPanelMenu.find('ul.category-menu').hide();
                $jPanelMenu.find('ul.main-menu').fadeIn();
            }

            function showCategoryMenu() {
                var $jPanelMenu = $('#jPanelMenu-menu');
                $jPanelMenu.find('ul.main-menu').hide();
                $jPanelMenu.find('ul.category-menu').fadeIn();
            }

            $('.menu-category').click(function() {
                var jPM = $.jPanelMenu({
                    duration: 500,
                    beforeOpen: function() {
                        showCategoryMenu();
                    },
                    afterClose: function() {
                        showMainMenu();
                    }
                });
                if(jPM.isOpen()) {
                    showCategoryMenu();
                } else {
                    jPM.open();
                }
            });

            $('.category-menu').on('click', '.btn-back', function() {
                showMainMenu();
            });
        };

        $(document).ready(resizeContentWrapper);
        $(document).ready(initJPanelMenu);
        $(document).ready(initCategory);
        
        $(window).resize(resizeContentWrapper);
    })(jQuery);
</script>
</body>
</html>